!function(i){i.nbeatgridaccordion=function(i,e){this.init(i,e)},i.extend(i.nbeatgridaccordion.prototype,{settings:{cssClass:"nbeatgridaccordion",inputIdTransform:function(i){return i+"-nbeatgridaccordion"},inputNameTransform:function(i){}},debug:!1,grid:null,items:{},subId:0,subPosition:0,numitems:0,perline:1,resizeTimer:null,init:function(e,t){this.settings=i.extend({},this.settings,t),this.grid=i(e),this.buildItemList(),this.calculateItemsPerLine(),this.handleEvents()},buildItemList:function(){var e=this,t=0;this.grid.children().each(function(){var s=i(this)[0].id;e.items[s]=t,++t}),this.numitems=t},realWidth:function(e){var t=e.clone();t.css("visibility","hidden"),i("body").append(t);var s=t.outerWidth();return t.remove(),s},calculateItemsPerLine:function(){var e=i(".list-item",this.grid).first(),t=e.width(),s=this.grid.width(),n=Math.round(t/s*100);this.log("Real Calc, el: "+this.realWidth(e)),this.log("Real Calc, elWidth: "+this.realWidth(this.grid)),this.log("Calc, el: "+e),this.log("Calc, elWidth: "+t),this.log("Calc, gridWidth: "+s),this.log("Calc, percentage: "+n),this.perline=n<=21?5:n<=26?4:n<=34?3:n<=51?2:1,this.log("Calc items per line: "+this.perline)},handleEvents:function(){var e=this;i(window).resize(function(){clearTimeout(e.resizeTimer),e.resizeTimer=setTimeout(function(){e.calculateItemsPerLine(),e.repositionSubMenu()},250)}),i(".list-item",e.grid).on("click",function(t){e.calculateItemsPerLine(),i(this).hasClass("is-selected")?e.resetGrid():(e.subId=t.currentTarget.id,e.markSelected(),e.insertSubMenu())})},calculateSubMenuPosition:function(){var e=this.items[this.subId],t=0;i("#"+this.subId);return(t=Math.floor(e/this.perline)*this.perline+(this.perline-1))>=this.numitems&&(t=this.numitems-1),t},repositionSubMenu:function(){if(!(i(".expanded-category",this.grid).length<1)){var e=this.calculateSubMenuPosition(),t=i(".expanded-category",this.grid);this.log("Submenu position. Current: "+this.subPosition+". New: "+e),e!=this.subPosition&&(t.detach(),i(".list-item",this.grid).eq(e).after(t),this.subPosition=e),this.markSelected()}},resetGrid:function(){this.removeSubMenu(),i(".list-item",this.grid).removeClass("is-selected is-selected-neighbour")},markSelected:function(){var e=this.items[this.subId],t=Math.floor(e/this.perline)*this.perline;i(".is-selected-neighbour",this.grid).removeClass("is-selected-neighbour");for(var s=t;s<=t+(this.perline-1);++s)i(".list-item",this.grid).eq(s).addClass("is-selected-neighbour");i(".list-item",this.grid).removeClass("is-selected"),i("#"+this.subId).removeClass("is-selected-neighbour"),i("#"+this.subId).addClass("is-selected")},insertSubMenu:function(){var e=this.calculateSubMenuPosition(this.subId),t=i("<div>").addClass("expanded-category"),s=i("<ul>"),n=i("#"+this.subId+" .list-item-children").html();this.removeSubMenu(),s.html(n),t.append(s),i(".list-item",this.grid).eq(e).after(t),t.slideDown(),this.subPosition=e},removeSubMenu:function(){i(".expanded-category",this.grid).slideUp(function(){i(this).remove()})},log:function(i){!0===this.debug&&console.log(i)}}),i.fn.nbeatgridaccordion=function(e){return this.each(function(){i(this).data("nbeatgridaccordion",new i.nbeatgridaccordion(this,e))}),this}}(jQuery);